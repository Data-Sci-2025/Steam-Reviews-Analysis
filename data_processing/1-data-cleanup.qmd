---
title: "analysis pipeline"
format: gfm
---

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(dplyr)
library(stringr)
```

**Note**: reviews.csv is too large to upload to github right now, but using the data which is uploaded and the "data exploration" file, if you un-comment the write_csv chunk, you should be able to recreate it just fine. You'll just have to change the file path to read in for this one. 


```{r}
#| label: readingin
reviews_df <- read_csv("../private/reviews.csv")
reviews_df
```


In this current format, the steam id column is not correct, but I can confirm all the games are there. The first reviews are for amnesia and the ones at the end are for the Vampire: The Masquerade game. Once I fix the steam_id workflow I'll use distinct() to confirm there are 45 different game IDs. I could use that as well, later, to split training and testing data and to narrow down to x number of games per game (where possible).


```{r}
#| label: posneg
reviews_df <- reviews_df |>
    mutate(review_type =  str_replace_all(review_type, 
                c("‚úÖ" = "POS",
                  "‚ùå" = "NEG")))
```


Fix those pesky emoji columns

```{r}
#| label: reviews-df
reviews_df
```


```{r}
#| label: colchecks
diffrows <- reviews_df[reviews_df$review != reviews_df$engtxt, ]
diffrows
```


```{r}
#| label: col-diff
reviews_df |>
  filter(review_id==204166566)
```

the engtxt column is not actually different from the review column, the only difference being conversions of any reviews that just say "xx%" (100% being converted to 1) or anything with x/10 being also converted to a string of numbers. 

Now for column decisions. I'll keep review_id since it's a unique value for each different review. 

I don't know that the date column is extremely important. I might want to look at how quickly games get reviews (are they concentrated at release and fall off, or is it relatively steady? any spikes?) but I will probably edit the column to a better format. Ditch the time, look into MM/DD/YY format instead, or whatever works best in R. 

I don't think the purchased col is extremely important, it only marks if a review writer has purchased the game or not, which is not key to any of my analysis.

score and upvotes is based on user response to a comment. Users can upvote for helpfulness of a review, or mark it as funny. I can't find data on how exactly the review score is calculated, but I don't think these two factors will play a huge role in what I'm looking to do. 


```{r}
#| label: reviews-df2
reviews_df <- reviews_df |>
  select(review_id:review_type, review, steam_id)
reviews_df
```

```{r}
#| label: rowscheck
reviews_df |>
  distinct(review_id)
```



```{r}
#| label: row-dupes
dupes <- duplicated(reviews_df$review_id)

dupes2 <- reviews_df[dupes, ]
dupes2[200:nrow(dupes2), ]
```

```{r}
#| label: dupe-check
reviews_df |>
  filter(review_id==148416513)
```

For some reason, some reviews appear to have been duplicated. I'm going to revisit this once I fix my steam_id issue so I can pinpoint exactly what is being duplicated here and why... It looks like the duplicated game is command & conquer, but why.... 

I've been looking through some files and I can see that Command & Conquer are duplicated, Powerful Courses are duplicated, that's all I can seem to find, though. I don't know why these are duplicated, but I'll see what I can work out with some more searching and get rid of the duplicates once I know for sure. Again once the steam_id problem is fixed I'll be able to verify that I have 45 different steam_ids and just remove the duplicate value rows. 

I verified that none of my files are identical to each other, double checking by reading in any two that were similar in length and verifying that the reviews don't match. This is how I was able to verify that the only two games with duplicates are C&C and Powerful Courses.
Oddly, it doesn't seem like every single review for those games is duplicated, only some of them. No idea why. 

## List of Goals

- adjust the date column (DONE)
- clean up the text of non text items
- Word tokens and word count per review
- word types
- TTR

**Early Exploration**

- average review length
- most common words (with and without stop words)
- most common words for pos and for neg
- some stats (correlation) - length and review type, review and rating type, maybe some others
- TF-IDF

**Later Goals**

- build a classifier

## Date column

Date format as is: 2025.08.29 02:05

  - remove timestamp
  - reformat
  - change column class

```{r}
#| label: datecol
reviews_df <- reviews_df |>
  mutate(date = str_replace_all(date, "(\\d{4})\\.(\\d{2})\\.(\\d{2}).*", "\\1-\\2-\\3"))
reviews_df$date <- as.Date(reviews_df$date)  
  
reviews_df
```


## Text Cleaning

```{r}
#| label: review-text
reviews_df |>
  select(review)
```


```{r}
#| label: text-replace
reviews_df <- reviews_df |>
   mutate(review =  str_replace_all(review, 
                c("\n" = " ",
                  "\\(" = "",
                  "\\)" = "",
                  "(\\w)/(\\w)" = "\\1 \\2",
                  "(\\w) / (\\w)" = "\\1 \\2",
                  "\\[.*?\\]" = "",
                  "‚†∏|‚¢π|‚†£|‚£õ|‚££|‚£Å|‚£ñ|‚£≠|‚†É|‚¢ª|‚£ß|‚£Ω" = "",
                  "‚£∑|‚£ü|‚¢∂|‚¢£|‚†Ñ|‚°ø|‚£Æ|‚£ª|‚£¶|‚¢õ|‚†ø|‚¢≠|‚†º|‚¢Ä" = "",
                  "‚°â|‚£∂|‚†ò|‚¢ø|‚°†|‚¢Ü|‚£≥|‚°µ|‚°Ö|‚†ô|‚£º|‚°Ñ|‚°ß|‚¢á" = "",
                  "‚£¥|‚£å|‚¢Ω|‚†ª|‚°õ|‚£§|‚°ù|‚£æ|‚†ö|‚£Ä|‚†è|‚°ª|‚¢ò|‚†é" = "",
                  "‚£ù|‚£∏|‚£∞|‚°Ü|‚£±|‚£°|‚¢ü|‚£Ø|‚°ü|‚¢†|‚†ë|‚†õ|‚¢∏|‚¢Ø" = "",
                  "‚¢é|‚£ï|‚°Æ|‚†ù|‚°æ|‚°Ø|‚†ï|‚°π|‚°Ç|‚¢à|‚†ü|‚†¢|‚£é" = "",
                  "‚°™|‚°±|‚¢î|‚°ë|‚¢ä|‚¢ä|‚††|‚†°|‚†à|‚°å|‚†™|‚£∫|‚°Ω" = "",
                  "‚£ó|‚¢â|‚¢Ñ|‚£ê|‚¢Ç|‚¢ê|‚°î|‚°Ä|‚†Å|‚¢ë|‚¢®|‚°Å" = "",
                  "‚¢Æ|‚£Ü|‚†ê|‚£´|‚¢∑|‚¢Æ|‚¢ó|‚¢™|‚£¨|‚¢ú|‚¢æ|‚£û" = "",
                  "‚¢ó|‚†•|‚†®|‚¢™|‚†Ç|‚£¨|‚°ó|‚†ß|‚¢û|‚£™|‚¢±|‚£¨" = "",
                  "‚°®|‚°∑|‚¢ö|‚†π|‚°é|‚¢•|‚†Ä|‚°∫|‚¢å|‚°ä|‚°°|‚†±|‚†å" = "",
                  "‚°≤|‚£π|‚£ë|‚£®|‚¢≥|‚¢°|‚£ú|‚¢µ|‚£î|‚°∏|‚°≠|‚¢É" = "",
                  "‚¢¥|‚¢ï|‚°á|‚¢¨|‚¢Ö|‚£µ|‚†Æ|‚¢è|‚°í|‚°´|‚°ê|‚°≥" = "",
                  "‚†Ø|‚¢¢|‚°©|‚£É|‚†î|‚†ú|‚†á|‚†Ö|‚£á|‚°∞|‚†∞|‚£Ö" = "",
                  "‚°ò|‚°É|‚¢∞|‚°¨|‚°ú|‚¢ù|‚¢©|‚°¢|‚°º|‚£ò|‚†¨|‚†ä|‚¢§" = "",
                  "‚†´|‚¢º|‚°ï|‚£≤|‚°è|‚¢∫|‚°à|‚†§|‚£•|‚°•|‚†∂|‚†Ω|‚£•|‚¢¶" = "",
                  "‚†©|‚°ç|‚†µ|‚£â|‚£ö|‚†¥|‚†≠|‚£ì|‚°ã|‚†ó|‚£Ñ|‚£à|‚†ç" = "",
                  "‚†∫|‚£¢|‚†∑|‚†ã|‚†æ|‚£†|‚°¥|‚†Ü|‚¢ñ|‚†û|‚¢≤|‚¢Å|‚†â|‚¢ã" = "",
                  "‚¢ß|‚£Ç|‚¢ô|‚†≥|‚£è|‚°£|‚°û|‚†í|‚°∂|‚£©|‚†ì|‚£ç|‚†≤|‚°§" = "",
                  "‚¢´|‚£ô|‚£ä|‚†ñ|‚†¶|‚°ô|‚¢ì|‚°¶|‚£í|‚¢í|‚¢ç|‚¢í|‚£ã|‚£ã|‚°ñ|‚£ø|‚°ö|‚°ì" = "",
                  "‚ñÑ|‚ñë|‚îå|‚îº|‚ñê|‚ñÄ|‚ñì|‚ïù|‚ïî|‚ñå|‚ïó|‚ïö|‚ïê|‚ïë|‚ñí|√ë|‚îÇ|‚à©|‚ïì|‚ï´" = "",
                  "‚ïô|‚ï°|‚ï†|‚äô|‚ñÖ|‚î§|‚óè|‚ñÇ|‚ñÉ|‚ó•|‚ñà" = "",
                  
                  

                  "‚îÄ‚îÄ+" = "‚îÄ",
                  "__+" = "_",
                  
                  "  +" = " "
                  
                  )
                
                
                ))
```


I'm doing some exploring using str_view to dive in and look at what I want to get rid of to begin some real analysis. 

First - do I want to lowercase before tokenizing? I think yes but I have to recheck old homeworks to be sure. Definitely want to lowercase before looking at types and before doing tf-idf.

  - how do you make a set of word types in R anyway i don't know
  
Second - what to do with punctuation? I have to review previous work also.
  
For the sake of processing text, I'm first removing any parenthesis included. it could be interesting what gets put in a parenthetical statement vs outside, but for pure analysis and vectorizing we don't want them. 

There are some included kind of html(?) tags like [b] and [/b] of [h1] etc. I want to get rid of those too. 

Getting rid of /, sometimes it appears as word/word and others word / word. Replacing it with a space and will later process to move extra spaces down to one space
  - sometimes it appears in 7/10 or something. I'm keeping those but I have to think about what to do with it. It also depends on how the tokenizer handles it. If it tokenizes to [7] [/] [10] I think that's acceptable.


Questions - what do to with emojis? 

Sometimes they are used stylistically to split up reviews:
üìö Story / Narrative, ‚åõ Length, üîÅ Replayability

Other times functionally (this is about difficulty):
üî≤ Too easy
‚òëÔ∏è Casual-friendly
üî≤ Balanced/Normal
üî≤ Challenging
üî≤ Brutal but fair
üî≤ Pure chaos (PvP focus)

Sometimes in place of words:
At least one review, start to finish, contains one item only üí©
Another one looks like: This game is üí© but i still love it

Some reviews also have no words and will just say "7/10" and nothing else, what about those? 

What about abbreviations? I've seen af, wtf, omg, lmao, etc etc. 
  - there are a lot, i imagine just leave them as they are

There are also emoticons in the old style: :D, xD etc
I even saw ¬∞ Õú ñ Õ°¬∞, Ôæâ‚óï„ÉÆ‚óïÔæâ*:ÔΩ•Ôæü‚úß

LOTS of formatting choices people make for visual purposes:
=====, ‚òë and ‚òê (not as emojis), 

Or what about this...
There are a number of reviews using ‚£ø (and all the variations in the replace text chunk above) to create a kind of ASCII art that can be safely removed, it is not speech information at all.

Think about \\{.*?\\} - there are some unicodes that show up I was having trouble singling out so I have to figure that out. I think they're probably special characters used in some more elaborate emoticons/faces that didn't quite translate somewhere along the way. 

links? Lots of people are linking to things in their reviews.


```{r}
#| label: text-search
str_view(reviews_df$review, "/")
```




